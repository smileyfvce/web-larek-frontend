# Проектная работа "Веб-ларек"

Ссылка на репозиторий GitHub:

https://github.com/smileyfvce/web-larek-frontend

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

### Интерфейсы:

#### Интерфейс данных пользователя

```
interface IOrder {
  address: string;
	email: string;
	phone: string;
	payment: TPaymentОptions;
}
```

#### Интерфейс данных карточки

```
interface ICard{
  id: string;
	description: string;
	image: string;
	title: string;
	category: TCategoryList;
	price: number | null;
}
```

#### Интерфейс для модели данных карточек

```
interface ICardsList {
  cards: ICard[];
  preview: string | null;
}
```

#### Интерфейс данных корзины

```
interface ICart {
	cards: ICardData[];
}
```

### Типы:

#### Тип данных для категорий товаров

```
type TCategoryList =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```

#### Тип данных для вариантов оплаты

```
type TPaymentОptions = 'card' | 'cash' | null;
```

#### Тип данных для отображения информации товара на главной странице

```
type TMainCardInfo = Pick<ICard, 'category' | 'title' | 'image' | 'price'>;
```

#### Тип данных для отображения информации в модальном окне товара

```
type TModalCardInfo = Pick<
	ICard,
	'category' | 'title' | 'description' | 'image' | 'price'
>;
```

#### Тип данных для отображения информации товаров в корзине

```
type TCartCardInfo = Pick<ICard, 'id' | 'title' | 'price'>;
```

#### Тип данных для модального окна с выбором способа оплаты

```
type TModalPayment = Pick<IOrder, 'payment' | 'address'>;
```

#### Тип данных для модального окна с контактами

```
type TModalContacts = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс OrderData

##### Поля:

- `address: string` - адрес.
- `email: string` - почта.
- `phone: string` - номер телефона.
- `payment: TPaymentОptions` - способы оплаты.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

##### Методы:

- `setOrderInfo(info: IOrder)` - сохраняет введенные данные заказа
- `validationPaymentData(data: Record<keyof TModalPayment, string>):boolean` - проверка формы оплаты.
- `validationContactsData(data: Record<keyof TModalContacts, string>):boolean` - проверка формы контакты.
- `clear():void` - очистка данных из форм после отравки.

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек товаров.

##### Поля:

- `cards: ICard[]` - массив карточек.
- `preview: string | null` - для предварительного просмотра по id.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

##### Методы:

- `getItem(itemId: string):ICard[]` - возвращаем карточку по id.
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс CartData

Класс отвечает за хранение и логику работы с данными корзины.

##### Поля:

- `cards: ICard[]` - массив карточек.
- `totalPrice: number` - сумма стоимости товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

##### Методы:

- `addCard(card:ICard):void` - добавить товар.
- `deleteCard(cardId:string):void` - удаляет товар.
- `getTotalPrice():number` - складывает сумму.
- `clear():void` - очищает корзину после отправки.

### Слой представления

#### Класс CardsCatalog

Реализует отображение блока с товарами на главной странице

##### Поля:
 
- `element: HTMlElement[]` - элемент для размещения товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

##### Методы:

- `render(elements: HTMLElement[])` - добавляет все товары.
- `handlerCardClick()` - слушатель клика по карточке.

#### Класс Modal

Класс реализует модальное окно.

##### Поля:

- `element: HTMLElement` - элемент модального окна
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

##### Методы:

- `openModal():void` - открывает модальное окно.
- `closeModal():void` - закрывает модаьное окно.
- `handleEscButton():void` - слушатель кнопки esc при открытии.

#### Класс CardModalView

Реализация отображения общей информации карточки товара.

##### Поля:

- `element: HTMLElement` - элемент карточки товара.
- `render(cardInfo: TCardTModalCardInfo)` - получает и отображает данные.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

##### Методы:

- `render(elements: HTMLElement[])` - создаёт элемент карточки товара.
- `onClickBuyButton()` - слушатель клика на кнопку покупки.

#### Класс CartModalView

Класс отображения элементов корзины.

##### Поля:

- `element: HTMLElement` - элемент списка товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

##### Методы:

- `render()` - получает и отображает массив товаров.
- `onClickConfirm()` - слушатель кнопки оформления.
- `onClickDelete()` - слушатель кнопки удаления.

#### Класс AllFormsModalView

Класс реализует отображение форм заказа.

##### Поля:

- `element: HTMLElement` - элемент формы для заполнения.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

##### Методы:

- `render()` - отображает поля.
- `onClickConfirm()` - слушатель клика на кнопку оформления.
- `validateForm()` - проверяет данные на валидность.

#### Класс ConfirmModalView

Класс реализует отображение подтверждения оформления заказа.

##### Поля:

- `element: HTMLElement` - элемент последнего окна.

##### Методы:

- render(totalPrice: number) - отображает сумму.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

#### Список всех событий, которые могут генерироваться в системе:


##### События с классами слоя представления.

- `card:open` - открыть карточку.
- `card:submit` - добавить товар в корзину.

- `cart:open` - открыть корзину.
- `cart:submit` - оформить список заказа.
- `cart:delete` - удалить товар из корзины.

- `order:open` - открыть модалку способа оплаты.
- `order-address:input` - изменение данных адреса в форме способа оплаты.
- `order-address:validate` - валидация формы с адресом.
- `order-payment:changed` - переключение способа оплаты.
- `order:submit` - подтверждение формы способа оплаты.

- `order-contacts:open` - открыть модалку с контактами.
- `order-email:input` - изменение данных почты.
- `order-email:validate` - валидация формы с почтой.
- `order-phone:input` - изменение данных телефона.
- `order-phone:validate` - валидация формы с телефоном.
- `order-contacts:submit` - подтверждение формы контактов.

- `confirm:submit` - подтверждение формы успешного заказа.
- `modal:close` - закрыть модальное окно.

##### События с классами слоя данных.

- `card:changed` - изменение данных модалки карточки.
- `cart:changed` - изменение данных модалки корзины.
- `count:changed` - изменение счётчика товаров.
- `totalPrice:changed` - изменение суммы товаров в корзине.